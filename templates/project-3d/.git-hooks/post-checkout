#!/usr/bin/env bash
# Post-checkout hook to automatically run dvc checkout after git checkout
# This ensures DVC-tracked data is synchronized with the checked out Git state

# Only run dvc checkout if:
# 1. DVC is initialized (dvc.yaml or .dvc files exist)
# 2. This is not the initial checkout of a repository
# 3. We're switching between different commits/branches (not just file checkouts)

# Check if this is an initial checkout (clone)
if [ "$3" = "1" ]; then
    # Check if DVC is initialized in this project
    if [ -f "dvc.yaml" ] || [ -f ".dvc/config" ] || find . -maxdepth 2 -name "*.dvc" -type f | grep -q .; then
        echo "üîÑ DVC detected, syncing data after checkout..."
        if command -v dvc >/dev/null 2>&1; then
            dvc checkout 2>/dev/null || {
                echo "‚ö†Ô∏è  DVC checkout failed - some data files may not be available"
                echo "   Run 'dvc checkout' manually if needed"
                exit 0  # Don't block the git checkout
            }
            echo "‚úÖ DVC data synchronized"
        else
            echo "‚ö†Ô∏è  DVC command not found, skipping data sync"
        fi
    fi
fi

exit 0
